<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Download File Example</title>
</head>
<body>
  <h1>Download My File</h1>
  <p>Click below to download the file directly from Google Drive:</p>

  <!-- Empty link that will be filled automatically -->
  <a id="downloadLink" href="#" target="_blank">ðŸ“¥ Download APK</a>

  <script>
  // ðŸ§© Load link from JSON file
  fetch("filelink.json", { cache: "no-store" })
    .then(response => response.json())
    .then(data => {
      const link = document.getElementById("downloadLink");
      link.href = data.url;
    })
    .catch(err => {
      console.error("Error loading filelink.json:", err);
      document.getElementById("downloadLink").textContent = "Error loading download link.";
    });
  </script>

  <!-- ðŸ•’ 1-hour redirect security -->
  <script>
  (function () {
    const startKey = "pageStartTime";
    const guardPage = "index.html";         
    const ONE_HOUR = 60 * 60 * 1000;        
    const CHECK_EVERY = 5 * 60 * 1000;      

    let startTime = parseInt(localStorage.getItem(startKey), 10);
    if (Number.isNaN(startTime)) {
      startTime = Date.now();
      localStorage.setItem(startKey, String(startTime));
    }

    function msRemaining() {
      const elapsed = Date.now() - startTime;
      return Math.max(0, ONE_HOUR - elapsed);
    }

    function redirectToGuard() {
      try { localStorage.removeItem(startKey); } catch (e) {}
      window.location.replace(guardPage);
    }

    function checkAndRedirect() {
      if (msRemaining() <= 0) {
        redirectToGuard();
      }
    }

    const exactTimeout = setTimeout(checkAndRedirect, msRemaining());
    const interval = setInterval(checkAndRedirect, CHECK_EVERY);
    ["visibilitychange", "focus"].forEach(evt =>
      window.addEventListener(evt, checkAndRedirect)
    );
    window.addEventListener("beforeunload", () => {
      clearTimeout(exactTimeout);
      clearInterval(interval);
    });
  })();
  </script>

</body>
</html>
